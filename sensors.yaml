
    potenza_batteria_1:
      friendly_name: "Potenza Batteria 1"
      unit_of_measurement: W
      value_template: "{{ (states('sensor.seplos_n1_tensione')|float(0) * states('sensor.seplos_n1_corrente')|float(0)) | round(2) }}"

    potenza_batteria_2:
      friendly_name: "Potenza Batteria 2"
      unit_of_measurement: W
      value_template: "{{ (states('sensor.seplos_n2_tensione_2')|float(0) * states('sensor.seplos_n2_corrente_2')|float(0)) | round(2) }}"

    differenza_celle_n1:
      friendly_name: "Differenza tensione celle N1"
      unit_of_measurement: V
      value_template: "{{ (states('sensor.seplos_n1_max_tensione_celle')|float(0) - states('sensor.seplos_n1_min_tensione_celle')|float(0)) | round(3) }}"

    differenza_celle_n2:
      friendly_name: "Differenza tensione celle N2"
      unit_of_measurement: V
      value_template: "{{ (states('sensor.seplos_n2_max_tensione_celle_2')|float(0) - states('sensor.seplos_n2_min_tensione_celle_2')|float(0)) | round(3) }}"
      
      
    batterie_delta_max:
      friendly_name: "Δ Celle Max"
      unit_of_measurement: "V"
      value_template: >
        {% set d1 = states('sensor.differenza_celle_n1')|float(0) %}
        {% set d2 = states('sensor.differenza_celle_n2')|float(0) %}
        {{ [d1, d2] | max | round(3) }}

    batterie_volt_min:
      friendly_name: "Tensione Minima"
      unit_of_measurement: "V"
      value_template: >
        {% set v1 = states('sensor.seplos_n1_min_tensione_celle')|float(0) %}
        {% set v2 = states('sensor.seplos_n2_min_tensione_celle_2')|float(0) %}
        {{ [v1, v2] | min | round(2) }}

    batterie_ampere_tot:
      friendly_name: "Corrente Totale"
      unit_of_measurement: "A"
      value_template: >
        {% set a1 = states('sensor.seplos_n1_corrente')|float(0) %}
        {% set a2 = states('sensor.seplos_n2_corrente_2')|float(0) %}
        {{ (a1 + a2) | round(2) }}

    batterie_watt_tot:
      friendly_name: "Potenza Totale"
      unit_of_measurement: "W"
      value_template: >
        {% set w1 = states('sensor.seplos_n1_tensione')|float(0) %}
        {% set w2 = states('sensor.seplos_n2_tensione_2')|float(0) %}
        {{ (w1 + w2) | round(2) }}

    batterie_temp_media:
      friendly_name: "Temperatura Media"
      unit_of_measurement: "°C"
      value_template: >
        {% set t1 = states('sensor.seplos_n2_env_temp')|float(0) %}
        {% set t2 = states('sensor.seplos_n1_env_temp')|float(0) %}
        {% if t1 == 0 and t2 == 0 %}
          0
        {% elif t1 == 0 %}
          {{ t2 }}
        {% elif t2 == 0 %}
          {{ t1 }}
        {% else %}
          {{ ((t1 + t2) / 2) | round(1) }}
        {% endif %}

    batterie_capacita_tot:
      friendly_name: "Capacità Totale"
      unit_of_measurement: "Ah"
      value_template: >
        {% set c1 = states('sensor.seplos_n1_remaining_capacity')|float(0) %}
        {% set c2 = states('sensor.seplos_n2_remaining_capacity')|float(0) %}
        {{ (c1 + c2) | round(1) }}
        

    seplos_equalization_status_1:
      friendly_name: "Bilanciamento Celle n1"
      value_template: >
        {% set code = states('sensor.seplos_equalization_state') | int(0) %}
        {% if code == 0 %}
          Off
        {% elif code == 1 %}
          Attivo
        {% else %}
          Stato {{ code }}
        {% endif %}
        
    seplos_equalization_status_2:
      friendly_name: "Bilanciamento Celle n2"
      value_template: >
        {% set code = states('sensor.seplos_equalization_state') | int(0) %}
        {% if code == 0 %}
          Off
        {% elif code == 1 %}
          Attivo
        {% else %}
          Stato {{ code }}
        {% endif %}

    